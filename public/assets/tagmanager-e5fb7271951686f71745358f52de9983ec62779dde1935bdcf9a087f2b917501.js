!function(t){"use strict";var e={prefilled:null,CapitalizeFirstLetter:!1,preventSubmitOnEnter:!0,isClearInputOnEsc:!0,AjaxPush:null,AjaxPushAllTags:null,AjaxPushParameters:null,delimiters:[9,13,44],backspace:[8],maxTags:0,hiddenTagListName:null,hiddenTagListId:null,replace:!0,output:null,deleteTagsOnBackspace:!0,tagsContainer:null,tagCloseIcon:"x",tagClass:"",validator:null,onlyTagList:!1,tagList:null},i={pushTag:function(e,i){var o,s,r,a,l,u,d,c,h,p,f,m,g=t(this),v=g.data("opts"),y=g.data("tlis"),b=g.data("tlid");if(e=n.trimTag(e,v.delimiterChars),e&&!(e.length<=0)){if(v.onlyTagList&&void 0!==v.tagList&&v.tagList){var _=v.tagList;t.each(_,function(t,e){_[t]=e.toLowerCase()});var w=t.inArray(e.toLowerCase(),_);if(-1===w)return}v.CapitalizeFirstLetter&&e.length>1&&(e=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()),v.validator&&!v.validator(e)||v.maxTags>0&&y.length>=v.maxTags||(o=!1,s=jQuery.map(y,function(t){return t.toLowerCase()}),l=t.inArray(e.toLowerCase(),s),-1!==l&&(o=!0),o?(g.trigger("tm:duplicated",e),t("#"+g.data("tm_rndid")+"_"+b[l]).stop().animate({backgroundColor:v.blinkBGColor_1},100).animate({backgroundColor:v.blinkBGColor_2},100).animate({backgroundColor:v.blinkBGColor_1},100).animate({backgroundColor:v.blinkBGColor_2},100).animate({backgroundColor:v.blinkBGColor_1},100).animate({backgroundColor:v.blinkBGColor_2},100)):(i||g.trigger("tm:pushing",e),r=Math.max.apply(null,b),r=r===-(1/0)?0:r,a=++r,y.push(e),b.push(a),i||null!==v.AjaxPush&&null==v.AjaxPushAllTags&&-1===t.inArray(e,v.prefilled)&&t.post(v.AjaxPush,t.extend({tag:e},v.AjaxPushParameters)),u=g.data("tm_rndid")+"_"+a,d=g.data("tm_rndid")+"_Remover_"+a,c=t("<span/>").text(e).html(),h='<span class="'+n.tagClasses.call(g)+'" id="'+u+'">',h+="<span>"+c+"</span>",h+='<a href="#" class="tm-tag-remove" id="'+d+'" TagIdToRemove="'+a+'">',h+=v.tagCloseIcon+"</a></span> ",p=t(h),null!==v.tagsContainer?t(v.tagsContainer).append(p):a>1?(f=a-1,m=t("#"+g.data("tm_rndid")+"_"+f),m.after(p)):g.before(p),p.find("#"+d).on("click",g,function(e){e.preventDefault();var i=parseInt(t(this).attr("TagIdToRemove"));n.spliceTag.call(g,i,e.data)}),n.refreshHiddenTagList.call(g),i||g.trigger("tm:pushed",e),n.showOrHide.call(g)),g.val(""))}},popTag:function(){var e,i,o=t(this),s=o.data("tlis"),r=o.data("tlid");r.length>0&&(e=r.pop(),i=s[s.length-1],o.trigger("tm:popping",i),s.pop(),t("#"+o.data("tm_rndid")+"_"+e).remove(),n.refreshHiddenTagList.call(o),o.trigger("tm:popped",i))},empty:function(){for(var e,i=t(this),o=i.data("tlis"),s=i.data("tlid");s.length>0;)e=s.pop(),o.pop(),t("#"+i.data("tm_rndid")+"_"+e).remove(),n.refreshHiddenTagList.call(i);i.trigger("tm:emptied",null),n.showOrHide.call(i)},tags:function(){var t=this,e=t.data("tlis");return e}},n={showOrHide:function(){var t=this,e=t.data("opts"),i=t.data("tlis");e.maxTags>0&&i.length<e.maxTags&&(t.show(),t.trigger("tm:show")),e.maxTags>0&&i.length>=e.maxTags&&(t.hide(),t.trigger("tm:hide"))},tagClasses:function(){var e,i=t(this),n=i.data("opts"),o=n.tagBaseClass,s=n.inputBaseClass;return e=o,i.attr("class")&&t.each(i.attr("class").split(" "),function(t,i){-1!==i.indexOf(s+"-")&&(e+=" "+o+i.substring(s.length))}),e+=n.tagClass?" "+n.tagClass:""},trimTag:function(e,i){var n;for(e=t.trim(e),n=0;n<e.length&&-1===t.inArray(e.charCodeAt(n),i);n++);return e.substring(0,n)},refreshHiddenTagList:function(){var e=t(this),i=e.data("tlis"),n=e.data("lhiddenTagList");n&&t(n).val(i.join(e.data("opts").baseDelimiter)).change(),e.trigger("tm:refresh",i.join(e.data("opts").baseDelimiter))},killEvent:function(t){t.cancelBubble=!0,t.returnValue=!1,t.stopPropagation(),t.preventDefault()},keyInArray:function(e,i){return-1!==t.inArray(e.which,i)},applyDelimiter:function(e){var n=t(this);i.pushTag.call(n,t(this).val()),e.preventDefault()},prefill:function(e){var n=t(this);t.each(e,function(t,e){i.pushTag.call(n,e,!0)})},pushAllTags:function(e,i){var n=t(this),o=n.data("opts"),s=n.data("tlis");o.AjaxPushAllTags&&("tm:pushed"===e.type&&-1!==t.inArray(i,o.prefilled)||t.post(o.AjaxPush,t.extend({tags:s.join(o.baseDelimiter)},o.AjaxPushParameters)))},spliceTag:function(e){var i,o=this,s=o.data("tlis"),r=o.data("tlid"),a=t.inArray(e,r);-1!==a&&(i=s[a],o.trigger("tm:splicing",i),t("#"+o.data("tm_rndid")+"_"+e).remove(),s.splice(a,1),r.splice(a,1),n.refreshHiddenTagList.call(o),o.trigger("tm:spliced",i)),n.showOrHide.call(o)},init:function(o){var s,r,a=t.extend({},e,o);return a.hiddenTagListName=null===a.hiddenTagListName?"hidden-"+this.attr("name"):a.hiddenTagListName,s=a.delimeters||a.delimiters,r=[9,13,17,18,19,37,38,39,40],a.delimiterChars=[],a.delimiterKeys=[],t.each(s,function(e,i){-1!==t.inArray(i,r)?a.delimiterKeys.push(i):a.delimiterChars.push(i)}),a.baseDelimiter=String.fromCharCode(a.delimiterChars[0]||44),a.tagBaseClass="tm-tag",a.inputBaseClass="tm-input",t.isFunction(a.validator)||(a.validator=null),this.each(function(){var e=t(this),o="",s="",r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";if(e.data("tagManager"))return!1;e.data("tagManager",!0);for(var l=0;5>l;l++)s+=r.charAt(Math.floor(Math.random()*r.length));if(e.data("tm_rndid",s),e.data("opts",a).data("tlis",[]).data("tlid",[]),null===a.output?(o=t("<input/>",{type:"hidden",name:a.hiddenTagListName}),e.after(o),e.data("lhiddenTagList",o)):e.data("lhiddenTagList",t(a.output)),a.AjaxPushAllTags&&(e.on("tm:spliced",n.pushAllTags),e.on("tm:popped",n.pushAllTags),e.on("tm:pushed",n.pushAllTags)),e.on("focus keypress",function(){t(this).popover&&t(this).popover("hide")}),a.isClearInputOnEsc&&e.on("keyup",function(e){27===e.which&&(t(this).val(""),n.killEvent(e))}),e.on("keypress",function(t){n.keyInArray(t,a.delimiterChars)&&n.applyDelimiter.call(e,t)}),e.on("keydown",function(t){13===t.which&&a.preventSubmitOnEnter&&n.killEvent(t),n.keyInArray(t,a.delimiterKeys)&&n.applyDelimiter.call(e,t)}),a.deleteTagsOnBackspace&&e.on("keydown",function(o){n.keyInArray(o,a.backspace)&&t(this).val().length<=0&&(i.popTag.call(e),n.killEvent(o))}),e.change(function(t){/webkit/.test(navigator.userAgent.toLowerCase())||e.focus(),n.killEvent(t)}),null!==a.prefilled)"object"==typeof a.prefilled?n.prefill.call(e,a.prefilled):"string"==typeof a.prefilled?n.prefill.call(e,a.prefilled.split(a.baseDelimiter)):"function"==typeof a.prefilled&&n.prefill.call(e,a.prefilled());else if(null!==a.output){if(t(a.output)&&t(a.output).val()){t(a.output)}n.prefill.call(e,t(a.output).val().split(a.baseDelimiter))}}),this}};t.fn.tagsManager=function(e){var o=t(this);return 0 in this?i[e]?i[e].apply(o,Array.prototype.slice.call(arguments,1)):"object"!=typeof e&&e?(t.error("Method "+e+" does not exist."),!1):n.init.apply(this,arguments):this}}(jQuery);